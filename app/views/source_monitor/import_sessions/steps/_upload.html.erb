<div class="space-y-6">
  <div class="rounded-lg border border-slate-200 bg-white shadow-sm">
    <div class="border-b border-slate-100 px-4 py-3">
      <h2 class="text-lg font-semibold text-slate-900">Upload OPML file</h2>
      <p class="mt-1 text-sm text-slate-600">Select an OPML file to begin. Parsing runs immediately so you can review results in Preview.</p>
    </div>
    <div class="px-4 py-5">
      <%= form_with model: import_session,
            url: source_monitor.step_import_session_path(import_session, step: "upload"),
            method: :patch,
            data: { turbo: false, action: "confirm-navigation#disable" },
            html: { enctype: "multipart/form-data", class: "space-y-4" } do |form| %>
        <% if defined?(@upload_errors) && @upload_errors.present? %>
          <div class="rounded-md border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-800">
            <ul class="list-disc space-y-1 pl-5">
              <% @upload_errors.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>
        <div>
          <%= form.label :opml_file, "OPML file", class: "block text-sm font-semibold text-slate-800" %>
          <p class="text-xs text-slate-500">Max size and validation are handled later in the flow.</p>
          <div class="mt-2 flex items-center gap-3">
            <%= form.file_field :opml_file, name: :opml_file, accept: ".opml, text/xml, application/xml", class: "block w-full text-sm text-slate-700" %>
          </div>
          <% if import_session.opml_file_metadata.present? %>
            <p class="mt-2 text-xs text-slate-500">Current upload: <%= import_session.opml_file_metadata["filename"] %></p>
          <% end %>
        </div>
        <div class="flex items-center justify-end gap-3">
          <%= link_to "Cancel", source_monitor.import_session_path(import_session),
                data: { turbo_method: :delete, action: "confirm-navigation#disable" },
                class: "inline-flex items-center rounded-md border border-slate-200 px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-50" %>
          <%= hidden_field_tag :next_step, "preview", name: "import_session[next_step]" %>
          <%= form.submit "Continue", class: "inline-flex items-center rounded-md bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-blue-500" %>
        </div>
      <% end %>
    </div>
  </div>
</div>
